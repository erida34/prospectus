### Глава 7. Сети
- **Важность сети**: сеть – основа инфраструктуры компании. Плохо спроектированная сеть негативно влияет на все компоненты системы.
- **Проектирование сети**:
  - Решения по проектированию сети влияют на внедрение инфраструктурных сервисов.
  - Необходимо консультироваться с ответственными за проектирование сервисов.

#### Рекомендуемая литература:
- **Общие принципы сетей**: Perlman 1999.
- **TCP/IP**: Stevens 1994, Comer 2000.
- **Маршрутизаторы и коммутаторы**: Berkowitz 1999.
- **Сетевые архитектуры**: Berkowitz 1998.
- **Конкретные технологии**: Black 1999.
- **Глобальные сети**: Marcus 1999, Feit 1999.
- **Протоколы маршрутизации**: Black 2000.
- **Отдельные протоколы**:
  - OSPF: Moy 2000, Thomas 1998.
  - EIGRP: Pepelnjak 2000.
  - BGP: Stewart 1999, Halabi and McPherson 2000.
  - MPLS, VPN, QoS: Black 2001, Guichard and Pepelnjak 2000, Lee 1999, Vegesna 2001, Keagy 2000, Maggiora et al. 2000.
  - Групповая передача: Williamson 2000.
  - ATM: Pildush 2000.
  - Ethernet: Spurgeon 2000.

### 7.1. Основы
- **Цель сети**: создать надежную, документированную, простую в обслуживании сеть с высокой пропускной способностью и потенциалом роста.
- **Факторы успеха**:
  - Физические сети.
  - Топология логических сетей.
  - Документирование.
  - Маршрутизация узлов сети.
  - Протоколы маршрутизации.
  - Мониторинг и управление административными единицами.

#### Различия между локальными и глобальными сетями:
- **Локальные сети (LAN)**:
  - Пример: Fast Ethernet (шинная архитектура).
  - Тенденции: переход от кольцевых архитектур (FDDI) к шинным и обратно.
- **Глобальные сети (WAN)**:
  - Пример: SONET, MONET (кольцевые архитектуры).
  - Тенденции: циклическое изменение архитектур.

#### Пример:
- В 2007 году 10-гигабитные локальные сети вернулись к кольцевой архитектуре, что демонстрирует цикличность тенденций.

### 7.1.1. Модель OSI
- **Модель OSI (Open Systems Interconnection)**:
  - Описывает сеть как логические уровни.
  - Уровни:
    1. **Физический**: физическое подключение (кабели, оптоволокно, беспроводные каналы).
    2. **Канальный**: MAC-адресация, управление потоками данных.
    3. **Сетевой**: логическая адресация (IP-адреса) и маршрутизация (RIP, OSPF, IGRP).
    4. **Транспортный**: доставка данных, проверка ошибок (TCP).
    5. **Сеансовый**: управление сеансами связи (PPTP, AppleTalk).
    6. **Уровень представления**: форматы данных (ASCII, HTML, MP3), шифрование, сжатие.
    7. **Прикладной**: протоколы приложений (HTTP, SMTP, FTP).

- **Уровни 8, 9, 10 (шутка)**:
  - Уровень 8: пользовательский.
  - Уровень 9: финансовый.
  - Уровень 10: политический.

### 7.1.2. Понятная архитектура
- **Цель**: создать простую и понятную сетевую архитектуру.
- **Преимущества**:
  - Упрощает решение проблем.
  - Позволяет легко описать маршруты трафика.
  - Упрощает управление сетью.

- **Примеры проблем сложной архитектуры**:
  - **Поддержка поставщика**: сложная сеть затрудняет получение помощи от поставщика.
  - **Поддержка администраторов**: сложная сеть увеличивает время поиска и устранения неисправностей.

- **Рекомендации**:
  - Ограничьте количество сетевых протоколов (например, используйте только TCP/IP).
  - Используйте туннелирование для поддержки других протоколов поверх TCP/IP.
  - Упрощайте архитектуру для повышения надежности и удобства обслуживания.

### 7.1.3. Топологии сетей
- **Топология "звезда"**:
  - Центральный узел (коммутатор или маршрутизатор) соединяет все остальные узлы.
  - **Преимущества**: простота, экономичность.
  - **Недостатки**: уязвимость центрального узла (его отказ приводит к отключению всей сети).
  - **Пример**: локальная сеть в здании или глобальная сеть с центральным офисом.

- **Топология "несколько звезд"**:
  - Несколько центральных узлов, связанных между собой избыточными каналами.
  - **Преимущества**: снижение риска отказа, распределение нагрузки.
  - **Пример**: глобальная сеть с региональными центрами.

- **Топология "кольцо"**:
  - Каждый узел подключен к двум другим, образуя кольцо.
  - **Преимущества**: отказоустойчивость (при отказе одного канала связь сохраняется).
  - **Пример**: кольца SONET в глобальных сетях.

- **Гибридная топология**:
  - Комбинация звезд и колец для повышения надежности.
  - **Пример**: краевые узлы связаны с центрами других звезд для резервирования.

- **Топология "хаос"**:
  - Узлы соединены произвольно, как в Интернете.
  - **Преимущества**: высокая адаптивность и отказоустойчивость.
  - **Недостатки**: сложность управления и описания.
  - **Пример**: Интернет.

#### Логические топологии:
- **Плоская топология**:
  - Одна большая сеть уровня 2 без маршрутизаторов.
  - **Пример**: небольшие локальные сети.

- **Топология на основе местоположения**:
  - Сети уровня 2 разделены по физическому расположению (например, по этажам).
  - **Пример**: сеть на каждом этаже здания, соединенная через маршрутизатор.

- **Топология на основе функциональных групп**:
  - Сети уровня 2 разделены по функциональным группам (например, отдел продаж, технический отдел).
  - **Пример**: отдельные сети для разных отделов, соединенные через маршрутизатор.

#### Примеры:
- **Несовместимая сетевая архитектура**: выбор протокола маршрутизации без учета пропускной способности привел к неэффективному использованию каналов.
- **Проектирование сетевых сервисов**: филиалы компании были сделаны независимыми, чтобы они могли работать без подключения к центральной сети.

# 7.1.4 Промежуточный кабельный узел (IDF)

## Основные понятия
- **IDF (Intermediate Distribution Frame)** – коммутационный шкаф, часть кабельной системы, соединяющей компьютеры с сетью.
- **MDF (Main Distribution Frame)** – центральный кабельный узел, к которому подключаются IDF.

## Кабели и технологии
- **Категории кабелей**:
  - Cat3: 10 Мбит/с, до 100 м.
  - Cat5: 100 Мбит/с, до 100 м.
  - Cat6: 1000 Мбит/с, до 90 м.
  - Cat7: 10 Гбит/с.
- Использование качественных кабелей продлевает срок службы системы (минимум 5 лет).

## Организация IDF
- **Размещение**:
  - Один IDF на этаж или больше для больших зданий.
  - Вертикальное размещение IDF упрощает прокладку кабелей и обслуживание.
- **Нумерация**:
  - Номера IDF должны включать здание, этаж и шкаф.
  - Сетевые разъемы должны быть промаркированы.
- **Безопасность**:
  - IDF должны быть закрыты и доступны только подготовленным сотрудникам.
  - Рекомендуется использовать защиту электропитания и охлаждение.

## Подключения
- **Патч-панели** предпочтительнее коммутационных блоков.
- **Патч-кабели** – короткие кабели для подключения устройств. Рекомендуется использовать готовые, а не самодельные.

## Рекомендации
- Устанавливайте больше сетевых разъемов, чем требуется, на этапе строительства.
- Тестируйте кабели после прокладки и требуйте журнал тестовых распечаток от подрядчиков.
- Используйте цветовую маркировку с буквенными обозначениями для удобства.

## Экономия и планирование
- Основные затраты – строительные работы, а не кабели.
- Прокладка оптоволокна должна быть выполнена на этапе строительства, даже если разъемы не используются сразу.


# 7.1.5. Центральный кабельный узел (MDF)

## Основные понятия
- **MDF (Main Distribution Frame)** – центральный узел, соединяющий все IDF.
- **Запасные кабели**: Всегда оставляйте запас кабелей между MDF и IDF для будущих подключений.
- **Безопасность и инфраструктура**:
  - MDF требует защиты электропитания, охлаждения и физической безопасности.
  - Часто MDF является частью вычислительного центра и называется сетевым рядом.
- **Подключения**:
  - Патч-панели в MDF подключены к патч-панелям в стойках вычислительного центра.
- **Расположение MDF**:
  - В небольших комплексах все IDF подключаются к одному MDF.
  - В крупных комплексах MDF могут быть в каждом здании, подключенные к центральному MDF.

# 7.1.6. Точки разграничения

## Основные понятия
- **Точка разграничения** – граница между вашей сетью и сетью поставщика услуг (например, интернет-провайдера).
- **Расположение**:
  - Может быть распределительным шкафом, коммутационным блоком, сетевым устройством или коробкой на стене.
- **Ответственность**:
  - Поставщик услуг отвечает за линию до точки разграничения.
  - Вы отвечаете за тестирование и обслуживание линии от точки разграничения до вашего оборудования.
- **Маркировка**: Все точки разграничения должны быть четко промаркированы.

# 7.1.7. Документирование

## Основные виды документации
- **Маркировка**: Основной элемент документации. Включает ярлыки на патч-панелях, кабелях и междугородных линиях.
- **Карты сети**:
  - **Физическая карта**: Отображает проводку, конечные точки, радиус действия беспроводных точек и избыточные пути.
  - **Логическая карта**: Показывает топологию сети, сетевые номера, имена, скорость, протоколы маршрутизации и административные домены.

## Маркировка
- **Патч-панели**: Должны быть четко промаркированы с указанием физического местоположения и подключений.
- **Междугородные линии**: Ярлыки должны содержать информацию о назначении линии, контактах для устранения проблем и идентификаторе цепи.
- **Временная проводка**: Также должна быть маркирована, но важно поддерживать актуальность маркировки.

## Упрощение маркировки
- **Серийные номера**: Использование кабелей с уникальными серийными номерами на обоих концах.
- **Цветовые ярлыки**: Для обозначения типа кабеля (например, витая пара, оптоволокно).
- **Связки для кабелей**: Использование плоских ушек для крепления самоклеющихся ярлыков.

## Онлайн-документирование
- **Комментарии в устройствах**: Использование полей комментариев в конфигурации сетевых устройств для упрощения администрирования.
- **Стандарты именования**: Пример: именование маршрутизаторов по схеме `mesto2mtview` (например, `denver2mtview`).

## Пример использования комментариев
- **ГВС-соединения**: В комментариях указывать поставщика, телефон, идентификатор цепи и номер договора.
- **ЛВС-соединения**: Указывать имя подсети, контактную информацию владельца, номера комнат и разъемов.

# 7.1.8. Простая маршрутизация

## Основные принципы
- **Маршрутизация должна быть простой**: Не усложняйте конфигурацию узлов. Используйте стандартный шлюз (маршрут) для узлов с одним сетевым интерфейсом.
- **Динамическая маршрутизация**: Узлы с одним сетевым интерфейсом не должны принимать динамическую маршрутную информацию.
- **Статичная маршрутизация**: Узлы с несколькими сетевыми интерфейсами должны использовать статичные маршруты и не участвовать в динамической маршрутизации.

## Проблемы сложной маршрутизации
- **UNIX-системы и RIP**: Использование протоколов маршрутизации (например, RIP) на узлах может привести к перегрузке процессора и сети.
- **Ошибки конфигурации**: Неверные настройки узлов могут распространять ложную маршрутную информацию, что приводит к сбоям в сети.
- **Безопасность**: Запретите отправку протоколов маршрутизации в локальные сети, где они не нужны, чтобы избежать случайных или намеренных ошибок.

## Рекомендации
- **Узлы с одним интерфейсом**: Должны иметь только один стандартный маршрут.
- **Узлы с несколькими интерфейсами**:
  - Трафик должен направляться через интерфейс, подключенный к целевой сети.
  - Для сетей, не подключенных напрямую, используйте статичный стандартный маршрутизатор.
- **Избегание сложности**: Минимизируйте использование дополнительных статичных маршрутов, чтобы упростить диагностику и повысить предсказуемость.

## Пример проблем
- **Кейс**: В крупной компании использование динамической маршрутизации на всех узлах привело к нестабильности сети из-за ошибок в конфигурации и несовместимости протоколов.
- **Решение**: Использование простой статичной маршрутизации могло бы предотвратить эти проблемы.

## Производительность
- **Широковещательные трансляции**: Протоколы маршрутизации, использующие широковещательные сообщения, могут снижать производительность сети, даже если узлы не участвуют в маршрутизации.
- **Пассивный режим**: Если подсеть содержит только один маршрутизатор, используйте пассивный режим для предотвращения ненужных трансляций.

# 7.1.9. Сетевые устройства

## Основные принципы
- **Выделенные устройства**: Используйте специализированные сетевые устройства (маршрутизаторы, коммутаторы) вместо универсальных узлов.
- **Оптимизация**: Сетевые устройства оптимизированы для передачи пакетов, снижения задержек и упрощения управления сетью.
- **Проблемы универсальных устройств**:
  - Универсальные узлы (например, файловые серверы с функциями маршрутизации) снижают производительность и усложняют диагностику.
  - Пример: Узел с несколькими сетевыми адаптерами, выполняющий маршрутизацию и другие сервисы, может стать узким местом в сети.

## Брандмауэры
- **Аппаратные брандмауэры**: Предпочтительнее программных решений, так как они специализированы и менее подвержены сбоям.
- **Программные брандмауэры**: Могут быть гибкими, но рискованны из-за возможного добавления дополнительных сервисов, что снижает безопасность.

## Графики обновления
- **Сетевые устройства**: Обновляются реже, чем серверы приложений.
- **Серверы**: Часто переконфигурируются и перезагружаются, что несовместимо с сетевыми устройствами.

## Пример проблем
- **Кейс**: В компании использовался сервер Apple OS X для маршрутизации, брандмауэра, почтового и файлового сервера. Проблемы с одним сервисом влияли на все остальные.
- **Решение**: Переход на выделенные аппаратные брандмауэры повысил стабильность сети.

## Домашние маршрутизаторы
- **Рекомендация**: Используйте аппаратные маршрутизаторы для домашних сетей. Они дешевы, энергоэффективны и бесшумны.

# 7.1.10. Оверлейные сети

## Основные понятия
- **Оверлейная сеть**: Логическая топология, наложенная на физическую сеть (например, VLAN, Frame Relay, ATM).
- **Преимущества**:
  - Простая физическая архитектура поддерживает сложные логические структуры.
  - Упрощает управление и масштабирование сети.

## Примеры использования
- **Глобальные сети (ГВС)**:
  - Использование ATM или Frame Relay для создания виртуальных каналов между офисами.
  - VPN-туннели через Интернет для создания защищенных соединений.
- **Локальные сети (ЛВС)**:
  - VLAN (IEEE 802.1q) для создания логических подсетей на основе физической инфраструктуры.
  - Пример: Крупная сеть с 100 IDF и 4000 пользователей, где VLAN упростили управление и снизили затраты на обслуживание.

## Рекомендации
- **Диаграммы**: Создавайте отдельные диаграммы для физической и логической топологии сети.
- **Гибкость**: Оверлейные сети позволяют легко адаптироваться к изменениям без перестройки физической инфраструктуры.

# 7.1.11. Количество поставщиков

## Основные принципы
- **Минимизация поставщиков**:
  - Снижает сложность управления сетью.
  - Уменьшает проблемы совместимости оборудования.
  - Упрощает обучение администраторов и обновление ПО.
  - Позволяет получить скидки за объем поставок.
- **Недостатки эксклюзивного поставщика**:
  - Ни один поставщик не может быть лучшим во всех областях.
  - Отсутствие проверки взаимодействия с оборудованием других производителей.

## Рекомендации
- **Золотая середина**:
  - Используйте одного поставщика для каждого уровня сети (например, ГВС-маршрутизаторы от одного, коммутаторы локальной сети от другого).
  - Это обеспечивает баланс между совместимостью и гибкостью.

# 7.1.12. Стандартные протоколы

## Основные принципы
- **Использование стандартных протоколов**:
  - Обеспечивает совместимость оборудования от разных поставщиков.
  - Упрощает интеграцию и снижает зависимость от одного поставщика.
  - Позволяет использовать преимущества оборудования разных производителей.
- **Проблемы проприетарных протоколов**:
  - Привязывают к конкретному поставщику.
  - Усложняют получение скидок и внедрение новых технологий.
  - Могут вызвать проблемы при деловых трудностях поставщика.

## Рекомендации
- **Проверенные стандарты**:
  - Используйте стандарты IETF и IEEE, проверенные временем.
  - Убедитесь, что новые функции оборудования соответствуют стандартам.
  - Если поставщик предлагает проприетарные решения, уточните, как они будут взаимодействовать с оборудованием других производителей.

  # 7.1.13. Мониторинг

## Основные принципы
- **Цели мониторинга**:
  - Обеспечение быстрой и надежной работы сети.
  - Прогнозирование будущих потребностей и масштабирование сети.
  - Поддержание безотказности сети.
- **Типы мониторинга**:
  1. **Мониторинг в реальном времени**:
     - Оповещение о сбоях сетевых интерфейсов, проблемах маршрутизации и аномалиях трафика.
     - Пример: Всплески трафика могут указывать на вирусы или сбои, а падение трафика – на проблемы с проводкой.
  2. **Сбор статистических данных**:
     - Анализ тенденций для прогнозирования потребностей в пропускной способности.
     - Сбор данных о сбоях и ошибках для выявления аномалий и улучшения стабильности сети.

## Пример
- **Кейс**: В компании, занимающейся автоматизированным проектированием, наблюдались резкие всплески трафика в обеденное время из-за одновременного сохранения данных сотрудниками. Это не было проблемой, но требовало понимания для корректной интерпретации данных мониторинга.

## Рекомендации
- **Реальный мониторинг**:
  - Внедрите системы уведомлений о сбоях и восстановлениях.
  - Отслеживайте аномалии трафика для оперативного выявления проблем.
- **Статистический анализ**:
  - Используйте данные для прогнозирования роста нагрузки и планирования модернизации сети.
  - Собирайте данные о сбоях для анализа и улучшения стабильности.

# 7.1.14. Одна административная единица

## Основные принципы
- **Единое управление сетью**:
  - Сеть должна управляться одной административной группой с едиными правилами и инструкциями.
  - Разделение управления между разными группами приводит к несогласованности и снижению эффективности.
- **Проблемы разделенного управления**:
  - Пример: В крупной компании разные группы использовали разные протоколы маршрутизации, что приводило к маршрутным петлям и сбоям.
  - Отсутствие единого управления усложняет обеспечение безопасности сети.

## Рекомендации
- **Единая административная группа**:
  - Создайте централизованную структуру управления сетью.
  - Убедитесь, что все администраторы следуют единым стандартам и правилам.
- **Безопасность**:
  - Единое управление позволяет контролировать безопасность всей сети, а не отдельных ее частей.

# 7.2. Тонкости

## 7.2.1. Передовые технологии или надежность
- **Баланс между инновациями и надежностью**:
  - Старые технологии более надежны, но новые предлагают повышенную скорость и функциональность.
  - Рекомендации:
    - Тестируйте новые технологии в лаборатории перед внедрением.
    - Постепенно развертывайте новые решения.
    - Создавайте группы пользователей с разной толерантностью к риску.
    - Уведомляйте пользователей о возможных сбоях при использовании новых технологий.

- **Пример**:
  - Использование передовых технологий может привести к простоям, поэтому важно заранее информировать пользователей и руководство.

## 7.2.2. Несколько административных единиц
- **Разделение управления сетью**:
  - Если невозможно создать единую административную единицу, используйте четкие границы между частями сети.
  - Рекомендации:
    - Используйте пограничные протоколы маршрутизации (например, BGP) и брандмауэры.
    - Разделите обязанности между группами (например, ГВС, ЛВС, безопасность).
    - Создайте комиссию для выработки общих стандартов.

# 7.3. Заключение

## 7.3.1. Константы создания сети
- **Неизменные принципы**:
  1. Четкая архитектура сети.
  2. Надежность.
  3. Грамотное документирование и маркировка.
  4. Высокие стандарты проводки для IDF и MDF.
  5. Надежные системы энергопитания и охлаждения.
  6. Последовательное размещение IDF.
  7. Точки разграничения.
  8. Единая административная единица (или четкое разделение обязанностей).
  9. Использование стандартных протоколов (IETF, IEEE).
  10. Простая маршрутизация узлов.
  11. Выделенное сетевое оборудование.
  12. Минимальное количество поставщиков.
  13. Избегание ударных технологий.

## 7.3.2. Изменчивые аспекты создания сети
- **Аспекты, которые могут меняться**:
  1. Тип проводки (внутри и между помещениями).
  2. Топологии физических и логических сетей.
  3. Сетевые устройства и протоколы.
  4. Возможности подключения к ГВС.
  5. Структура подключения к Интернету.
  6. Методы избыточности.
  7. Технологии мониторинга.

## Итог
- Создание сети требует баланса между неизменными принципами и адаптацией к изменяющимся технологиям.
- Использование проверенных стандартов и выделенного оборудования обеспечивает надежность, а гибкость позволяет внедрять новые решения.