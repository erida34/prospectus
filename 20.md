### Глава 20: Технические перерывы

#### 20.1 Основы
- Технический перерыв – это короткий промежуток времени для выполнения большого объема работы по обслуживанию систем.
- Время технического перерыва должно определяться совместно с пользователями.
- Группа системных администраторов должна выполнять различные задачи, координируемые руководителем полета.
- Основы успеха включают координацию времени перерыва, создание общего плана изменений, организацию подготовительной работы, общение с пользователями и выполнение полного теста системы после завершения работы.

#### 20.1.1 Планирование времени
- Планируйте периодические технические перерывы совместно с остальной компанией.
- Избегайте дней в конце месяца, квартала и финансового года.
- Избегайте дней выпуска продуктов и сезонных ограничений.
- Установите и опубликуйте график заранее, желательно более чем на год.
- Пример: планирование времени технического перерыва в средней компании по разработке ПО.
- Пример: еженедельные технические перерывы в Lumeta.

#### 20.1.2 Планирование
- Планируйте задачи заранее, чтобы избежать непредвиденных событий.
- Заблаговременно планируйте технические перерывы для заказа и доставки оборудования.
- Руководитель полета отвечает за создание объявлений, планирование графика, приятие решений и мониторинг выполнения задач.

#### 20.1.3 Руководство
- Руководитель полета должен быть старшим системным администратором с хорошим представлением о компании.
- Руководитель полета не должен выполнять техническую работу во время перерыва.
- Руководитель полета может быть выбран из группы системных администраторов.
- Пример: выбор руководителя полета в средней компании по разработке ПО.

#### Таблица 20.1. Три этапа технического перерыва
| Этап       | Действие                                                                 |
|------------|--------------------------------------------------------------------------|
| Подготовка | Запланируйте время перерыва. Выберите руководителя полета. Подготовьте предложения изменений. Создайте общий план. |
| Выполнение | Отключите доступ. Выполните последовательность отключений. Выполните план. Выполните проверку. |
| Разрешение | Объявите о завершении. Включите доступ. Обеспечьте видимое присутствие. Будьте готовы к проблемам

#### 20.1.4 Управление предложениями изменений
- Все предложения изменений должны быть поданы за неделю до технического перерыва.
- Используйте сетевую область с контролем версий для управления предложениями.
- Форма предложения изменения должна включать: какие изменения планируются, на каких машинах будет выполняться работа, условия и сроки их выполнения, что должно работать для успешного изменения, что будет затронуто изменением, кто выполняет работу, время на выполнение и тестирование, процедуры тестирования, необходимое оборудование, процедура отмены и время на её выполнение.

#### 20.1.4.1 Пример 1 предложения изменения
- Изменение: Обновление программы сервера аутентификации SecurID с версии 1.4 до версии 2.1.
- Машины: tsunayoshi и shingen.
- Условия: Программа и лицензионные ключи версии 2.1 должны быть доставлены разработчиком к 14 сентября. Резервные копии должны быть сделаны в последний вечер перед перерывом.
- Зависимости: Сеть, служба командной строки и службы внутренней аутентификации (NIS).
- Затронуто: Удаленный доступ и доступ к защищенным областям, требующий аутентификации по маркерам.
- Время: 3 часа работы, 3 часа выделено.
- Выполняет: Джейн Смит.
- Дополнительные помощники: Нет.
- Процедура тестирования: Попытаться набрать номер, установить VPN-соединение, соединиться через ISDN и обеспечить доступ к каждой защищенной области. Проверить создание нового пользователя, удаление пользователя и изменение атрибутов пользователя; убедиться, что каждое изменение прошло успешно.
- Необходимое оборудование: Ноутбук с модемом и программой VPN, аналоговая линия, учетная запись внешнего интернет-провайдера, ISDN-модем и интерфейс базового уровня (BRI).
- Процедура отмены: Установка нового программного обеспечения в параллельную директорию и копирование базы данных в новое место. Не удалять старую программу и базу данных, пока не пройдет неделя успешной работы. Для отмены (занимает 5 минут плюс тестирование) изменить ссылки, чтобы они указывали на старую программу.

#### 20.1.4.2 Пример 2 предложения изменения
- Изменение: Переместить /home/de105 и /db/gene237 с anaconda на anachronism.
- Машины: anaconda, anachronism и shingen.
- Условия: Дополнительные диски для anachronism должны быть доставлены 17 сентября и установлены к 21 сентября. Резервные копии должны быть сделаны в последний вечер перед перерывом.
- Зависимости: Сеть, служба командной строки и службы внутренней аутентификации (NIS).
- Затронуто: Сетевой трафик в сети 172.29.100.x, все учетные записи с домашними директориями в /home/de105 и доступ к базе данных /db/gene237.
- Время: 1 час работы, 12 часов выделено.
- Выполняет: Грег Джонс.
- Дополнительные помощники: Нет.
- Процедура тестирования: Попытаться подключиться к этим директориям с нескольких подходящих узлов, загрузиться на рабочей станции под учетной записью с домашней директорией в /home/de105, убедиться, что она работает, создать базу данных gene, проверить на ошибки, запустить скрипт тестового доступа к базе данных из /usr/local/tests/gene/access-test.
- Необходимое оборудование: Доступ к узлу, не принадлежащему системному администратору.
- Процедура отмены: Старые данные удаляются после успешного тестирования, изменяются указанные местоположения директорий обратно на старые значения и перестраиваются таблицы. Отмена занимает 10 минут.

#### 20.1.5 Разработка общего плана
- За неделю до технического перерыва руководитель полета блокирует предложения изменений и начинает работу над общим планом.
- Общий план включает таблицы по одной на человека, указывающие задачи, время их выполнения, исполнителей и координаторов.
- Общий план перечисляет все задачи, выполняемые в течение времени перерыва, исполнителей, руководителя группы и взаимосвязи.
- Общий план включает полное тестирование всей системы после завершения работы.
- Пример: шаблон общего плана.

#### 20.1.6 Отключение доступа
- Первая задача при техническом перерыве – отключить или предотвратить доступ к системе и уведомить о техническом перерыве.
- Процесс может включать: размещение объявлений на всех входных дверях комплекса зданий, отключение всего удаленного доступа к системе, объявление по системе оповещения комплекса зданий, изменение сообщения автоответчика службы поддержки.
- Эти меры снижают вероятность того, что люди будут пытаться использовать системы во время технического перерыва.
- Перед началом технического перерыва проверьте консольные серверы и другие средства, которые будете использовать во время перерыва.

#### 20.1.7 Обеспечение механизмов и координации
- Ключевые технологии обеспечивают плавное течение технического перерыва.
- Последовательность отключения/загрузки важна для нормального отключения или загрузки машин.
- Машины, зависящие от других машин и служб, могут не работать правильно, если эти службы недоступны.
- Важно понимать и отслеживать взаимосвязи машин при отключении и загрузке.
- Пример: последовательность отключения/загрузки в одной компании.

#### 20.1.7.1 Последовательность отключения/загрузки
- В большинстве компаний некоторые системы или группы систем должны быть доступны другим системам для нормального отключения или загрузки.
- Машина, которая пытается загрузиться, когда недоступны машины и службы, используемые ею, не сможет работать правильно.
- Важно иметь список последовательности загрузки всех машин вычислительного центра с одной или несколькими машинами на каждом этапе.
- Пример: таблица последовательности загрузки.

#### 20.1.7.2 КВМ и служба консоли
- Два элемента вычислительных центров, которые облегчают управление, – это коммутатор КВМ (Keyboard Video and Mouse) и последовательные консольные серверы.
- Коммутатор КВМ позволяет нескольким компьютерам использовать одни и те же клавиатуру, видео и мышь.
- Последовательный консольный сервер подключает устройства с последовательными консолями к одному центральному устройству.
- Пример: использование коммутатора КВМ и последовательного консольного сервера для управления доступом к консоли.


#### 20.1.8 Выполнение
- Отключите доступ и выполните последовательность отключений.
- Выполните план и проверку.
- Объявите о завершении и включите доступ.
- Обеспечьте видимое присутствие и будьте готовы к проблемам.

#### 20.1.7.3 Радиостанции
- Ключевые технологии обеспечивают плавное течение технического перерыва.
- Последовательность отключения/загрузки важна для нормального отключения или загрузки машин.
- Машины, зависящие от других машин и служб, могут не работать правильно, если эти службы недоступны.
- Важно понимать и отслеживать взаимосвязи машин при отключении и загрузке.
- Пример: последовательность отключения/загрузки в одной компании.

#### 20.1.7.1 Последовательность отключения/загрузки
- В большинстве компаний некоторые системы или группы систем должны быть доступны другим системам для нормального отключения или загрузки.
- Машина, которая пытается загрузиться, когда недоступны машины и службы, используемые ею, не сможет работать правильно.
- Важно иметь список последовательности загрузки всех машин вычислительного центра с одной или несколькими машинами на каждом этапе.
- Пример: таблица последовательности загрузки.

#### 20.1.7.2 КВМ и служба консоли
- Два элемента вычислительных центров, которые обычно требуют доступ к консольным серверам, серверам аутентификации, машинам службы имен и серверам лицензий, серверам приложений и серверам данных.
- Коммутатор КВМ (Keyboard Video and Mouse) позволяет нескольким компьютерам использовать одну и ту же клавиатуру, видео и мышь.
- Последовательный консольный сервер подключает устройства с последовательными консолями к одному центральному устройству.
- Пример: использование коммутатора КВМ и последовательного консольного сервера для управления доступом к консоли.


#### 20.1.8 Выполнение
- Отключите доступ и выполните последовательность отключений.
- Выполните план и проверку.
- Объявите о завершении и включите доступ.
- Обеспечьте видимое присутствие и будьте готовы к проблемам.

#### 20.1.9 Радиосвязь и координация
- Некоторые ключевые технологии обеспечивают плавное течение технического перерыва.
- Последовательность отключения/загрузки важна для нормального отключения или загрузки машин.
- Машины, зависящие от других машин и служб, могут не работать правильно, если эти службы недоступны.
- Важно понимать и отслеживать взаимосвязи машин при отключении и загрузке.
- Пример: использование радиосвязи для координации работы во время технического перерыва.

#### 20.1.9.1 Пример 1 радиосвязи
- В одной компании создали список отключения/загрузки, представленный в таблице 20.2.
- Пример: таблица последовательности загрузки.

#### 20.1.9.2 КВМ и служба консоли
- Два элемента вычислительных центров, которые обычно требуют доступ к консольным серверам, серверам аутентификации, машинам службы имен и серверам лицензий, серверам приложений и серверам данных.
- Коммутатор КВМ позволяет нескольким компьютерам использовать одну и ту же клавиатуру, видео и мышь.
- Последовательный консольный сервер подключает устройства с последовательными консолями к одному центральному устройству.
- Пример: использование коммутатора КВМ и последовательного консольного сервера для управления доступом к консоли.

#### 20.1.10 Полное тестирование системы
- Завершающий этап технического перерыва – полное тестирование системы.
- Если перерыв короткий, вам может потребоваться выполнить только основные тесты.
- Если перерыв длительный, выполните полное тестирование всей системы.
- Пример: полное тестирование системы после технического перерыва.

### Скрытая инфраструктура
- Пользователи могут зависеть от серверов или служб, о которых не информируют администраторов.

### 20.1.11. Возобновите удаленный доступ
- Последним действием перед уходом должно быть возобновление удаленного доступа и восстановление сообщения на автоответчике.

### 20.1.12. Будьте на виду следующим утром
- Системные администраторы должны прийти на работу рано и быть на виду, чтобы решать проблемы и символизировать заботу о компании.

### 20.1.13. Обсуждение итогов
- После технического перерыва руководитель полета и старшие администраторы обсуждают проблемы и улучшения.
- Обсуждение помогает улучшить будущие технические перерывы.

### 20.2. Тонкости
- Для усовершенствования процесса технических перерывов полезно учитывать дополнительные аспекты.

### 20.2.1. Обучение нового руководителя полета
- Обучение новых руководителей полета помогает подготовить их к будущим техническим перерывам.
- Обучаемый может помогать в планировании и выполнении задач.

### 20.2.2. Анализ тенденций в данных истории
- Отслеживание времени выполнения задач и анализ данных помогают улучшить оценки и планирование.
- Это полезно для новых сотрудников, чтобы они не упускали возможности для техобслуживания.

### 20.2.3. Предоставление ограниченной доступности
- Возможно потребуется поддерживать доступность службы для определенной группы во время технического перерыва.
- Причины могут включать недавно обнаруженные ошибки или новый график работы подразделения.
- Планирование может требовать изменения архитектуры служб или внесения дополнительных уровней избыточности.
- Определите, каким пользователям потребуется доступ во время перерыва, и занесите эти потребности в список требований доступности служб.
- Создайте подробный план доступности, упрощая сетевую топологию и вводя избыточные системы.

### 20.2.4. Компании высокой доступности
- Компании высокой доступности не могут позволить себе крупные запланированные отключения.
- Требуется много избыточных систем для обеспечения высокой доступности.
- Обслуживание систем все равно необходимо, но гарантии доступности исключают технические перерывы.

### 20.2.4.1. Сходства
- Принципы проведения технических перерывов справедливы и для компаний высокой доступности.
- Планирование времени перерыва, сообщение пользователям, предварительное выполнение работ и наличие руководителя полета критически важны.
- Каждое действие должно иметь предложение по изменению, включающее тест для проверки избыточных систем.
- Руководитель полета должен строго следить за предельными сроками выполнения изменений.
- Системные администраторы должны быть на месте для быстрого решения проблем.
- Полезно краткое подведение итогов на следующий день.

### 20.2.4.2. Различия
- Необходимость избыточных систем для высокой доступности.
- Нет необходимости в отключении доступа, службы должны оставаться доступными.
- Нет полного списка отключения/загрузки, но должен быть список взаимных зависимостей между машинами.
- Физическая доступность на следующее утро неактуальна, но важна заметность и готовность помочь.
- Общение после техобслуживания обычно не требуется, если нет оставшихся проблем.
- Планирование технического перерыва должно учитывать избыточную архитектуру компании.
- В течение перерыва нужно внимательно следить за доступностью обслуживания и иметь план на случай ошибок.

### 20.3. Заключение
- Основы успешного технического перерыва делятся на подготовку, выполнение и работу с пользователями после техобслуживания.
- Заблаговременная подготовка и планирование способствуют спокойному протеканию перерыва.
- Во время перерыва необходимо отключение удаленного доступа и наличие инфраструктуры.
- План должен быть выполнен с минимальным количеством отклонений и строго соблюдаться.
- Хорошая работа с пользователями после перерыва важна для его успеха.
- Интеграция процесса обучения, хранение данных истории и анализ тенденций могут улучшить оценки и планирование.
- Правильное планирование и выполнение технического перерыва предотвращают неприятности.
