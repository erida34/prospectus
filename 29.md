### Глава 29. Веб-службы

#### 29.1. Основы

##### 29.1.1. Основные элементы веб-службы

- **URL**: Адрес информации в Сети, состоит из имени узла и пути к ресурсу.
- **Веб-сервер**: Обрабатывает HTTP-запросы и предоставляет данные. Примеры: Apache HTTP, AOLServer, Microsoft IIS.
- **Ответ веб-сервера**: Обычно статический файл, но может быть динамически сгенерирован через CGI.
  - **CGI**: Общий шлюзовой интерфейс для генерации динамического содержимого.
    - **GET**: Чтение данных.
    - **POST**: Обновление данных.
- **Динамическое содержимое**: Может быть создано с использованием PHP, Microsoft Active Server Pages.
- **Веб-клиент**: Интерпретирует и отображает страницу. Пример: веб-броузер.
- **AJAX**: Метод создания интерактивных веб-страниц, использующий JavaScript и XML.
- **Форматы данных**: HTML, XHTML, DHTML, XML, мультимедийные файлы (изображения, аудио, видео).
- **Коды ошибок HTTP**:
  - 200: OK
  - 301: Перемещено навсегда
  - 302: Перенаправление на указанный URL
  - 307: Временное перенаправление
  - 401: Требуется аутентификация
  - 403: Нет авторизации
  - 404: Страница не найдена

### 29.1.2. Роль веб-мастера

- **Веб-мастер**: Управляет содержимым веб-сайта, аналогично редактору газеты.
- **Различие с системным администратором**: Веб-мастер занимается содержимым, системный администратор – техническими устройствами.
- **Рекомендации для системных администраторов**:
  - Сосредоточьтесь на самообслуживании веб-сайта.
  - Установите SLA для запросов на обновления.
  - Участвуйте в процессах, ведущих к изменениям на веб-сайте.

### 29.1.3. Соглашения об уровне обслуживания

- **SLA**: Необходимо для веб-службы и мониторинга его соблюдения.
- **Уровень обслуживания**: Устанавливается в контакте с сообществом пользователей.
- **Показатели SLA**:
  - Задержка для определенного уровня запросов в секунду (QPS).
  - Время между приемом первого байта запроса и отправкой последнего байта ответа.

### 29.1.4. Архитектуры веб-служб

#### 29.1.4.1. Статический веб-сервер

- Предоставляет неизменяемые документы.
- Документы читаются напрямую с диска.
- Важно иметь достаточно оперативной памяти для кэширования часто запрашиваемых файлов.

#### 29.1.4.2. CGI-серверы

- Динамически генерируют страницы.
- Требуют больше ресурсов процессора и памяти.

#### 29.1.4.3. Веб-сайты на основе баз данных

- Доступ к информации в базе данных и ее модификация.
- Шаблоны для определенного типа данных.
- Обновление шаблона для глобального изменения формата.

#### 29.1.4.4. Мультимедийные серверы

- Предоставляют медиа-файлы (видео, аудио).
- Поддержка потоковой передачи.
- Важны хранение данных и пропускная способность сети.
- Потоковые серверы обеспечивают функции прямой и обратной перемотки.

#### 29.1.4.5. Несколько серверов на одном узле

- Веб-сервер на одной машине, но на другом порту.
- Использование нескольких сетевых интерфейсов с разными IP-адресами.
- Виртуальные интерфейсы (VIF) для совместного использования сетевого интерфейса.

### 29.1.5. Мониторинг

- **Цели мониторинга**: Оценка расширяемости, определение направлений совершенствования, соблюдение SLA.
- **Ошибки веб-серверов**: Часто связаны с проблемами содержимым сайта, полезны для веб-разработчиков.
- **Информация для мониторинга**: Тип броузера, URL страницы, сославшийся URL, данные в активных потоках, использование памяти.

### 29.1.6. Расширение веб-служб

- **Проблема расширения**: Основная проблема Интернета.
- **Slashdot-эффект**: Перегрузка сайта из-за большого количества запросов.
- **Методы расширения**:
  - **Горизонтальное расширение**: Воспроизведение веб-сервера или ресурса, разделение нагрузки.
    - **DNS-балансировка**: Циклические записи на DNS-серверах.
    - **Устройства балансировки нагрузки**: Направление запросов на наименее загруженный сервер.
  - **Вертикальное расширение**: Разделение различных видов служб.
    - **Пример**: Разделение видеоклипов и приложения опроса на разные серверы.
- **Выбор метода расширения**: Классификация компонентов по ресурсам, определение конкурирующих компонентов.
- **Проблемы расширения**:
  - **Состояние приложений**: Поддержка состояния броузером клиента или доступность для всех систем.
  - **CGI-программы**: Использование базы данных для хранения информации.
  - **Базы данных**: Разделение данных на предназначенные только для чтения и для чтения и записи.
- **Важность расширения**: Пример с сайтом избирательной комиссии Флориды.
- **Схема расширения**: Перенос функций на отдельные машины, дублирование элементов.

### 29.1.7. Безопасность веб-службы

- **Важность безопасности**: Защита от злоумышленников, использующих ресурсы веб-сервера.
- **Внутренние веб-службы**: Требуют безопасности из-за вирусов, конфиденциальной информации, посетителей и потенциальных уязвимостей.
- **Безопасные соединения и сертификаты**:
  - **HTTPS**: Шифрование веб-трафика через SSL.
  - **Сертификаты**: Криптографические сертификаты с внешней подписью от CA.
  - **Хранение ключей**: Зашифрованная форма, пароль для чтения ключа.
  - **Иерархия доверия**: От CA к подписанному сертификату и броузеру.
  - **SSL-ускорители**: Аппаратные ускорители для обработки SSL.
- **Защита приложения веб-сервера**:
  - **Уязвимости**: На различных уровнях реализации веб-сервера.
  - **Мониторинг**: Обнаружение попыток использования уязвимостей.
- **Защита содержимого**:
  - **Обход директорий**: Получение данных через иерархию директорий.
  - **Изменение поля формы**: Использование веб-форм для получения доступа к данным или службам.
  - **Внедрение SQL**: Создание SQL-элементов для нанесения повреждений.

### 29.1.7.4. Безопасность приложений

- **Ограничение ущерба**: Изоляция веб-сервера от внутренней сети, восстановление из внутренней системы.
- **Подтверждение входных данных**: Проверка длины данных, использование безопасных кавычек, фильтрация символов.
- **Автоматизация доступа к данным**: Специализированные программы, использование сохраненных процедур, подготовка входных данных.
- **Права и привилегии доступа**: Использование методов аутентификации, минимизация привилегий.
- **Ведение логов**: Хранение логов на других машинах или в нестандартных местах, сетевое ведение логов.

### 29.1.8. Управление содержимым

- **Роль системного администратора**: Не должен заниматься обновлением содержимого.
- **Веб-группа**: Создание веб-группы или веб-комиссии для управления содержимым.
- **Веб-комиссия**: Увеличение заметности работы системного администратора, создание потребности в выделенной должности веб-мастера.

### 29.1.8.2. Контроль изменений

- **Веб-комиссия**: Владелец процесса контроля изменений.
- **Типы изменений**:
  - **Обновление**: Добавление нового материала или замена версии документа.
  - **Изменение**: Смена структуры сайта.
  - **Исправление**: Коррекция содержимого документа или поведения сайта.
- **Процесс внесения исправления**: Открытие заявки на устранение неисправности, контроль качества.
- **Процесс внесения изменения**: Подтверждающее письмо, контроль качества перед публикацией.
- **Автоматизация**: Исключение системных администраторов из процесса, использование команды sudo для прав доступа.

### 29.1.9. Создание типового управляемого веб-сервера

- **Вопросы для уточнения запроса**:
  - Внутренний или внешний доступ?
  - Специальная задача или программа?
  - Кто будет пользоваться сервером и как?
  - Требования по безотказной работе?
  - Создание учетных записей или групп?
  - Требования к месту для хранения?
  - Предполагаемый трафик и его рост?
- **Планирование пространства имен URL**:
  - Избегание конфликтов назначения имен.
  - Использование функции include для создания отдельных файлов конфигурации.
- **Предоставление возможности запуска веб-программ**:
  - Ограничение потребления ресурсов.
  - Создание процесса для обновления содержимого веб-сайта.

### 29.1.9.2. Внутренний сайт

- **Простая модель публикации**: Корневой каталог документов с правами доступа для внутренних групп.
- **Отдельный сервер**: Для групп, требующих изменения веб-сервера.

### 29.1.9.3. Внешний сайт

- **Безопасность**: Блокировка неиспользуемых портов, расположение за брандмауэром.
- **Компоненты веб-сайта**:
  - Регистрация домена.
  - Интернет-хостинг DNS.
  - Веб-хостинг.
  - Веб-контент.

### 29.1.9.4. Процесс создания материалов веб-сайта

- **Процесс ввода в эксплуатацию**:
  - Черновик: Редактирование и загрузка образцов.
  - Контроль качества: Проверка, коррекция, тестирование.
  - Рабочий сервер: Публикация после прохождения контроля качества.
  - Эталонный сервер: Проверка интеграции и тестирование.

### 29.2. Тонкости

- **Веб-хостинг третьих сторон**:
  - **Преимущества**: Интеграция, использование услуг хостинга, сосредоточение на веб-службах.
  - **Недостатки**: Беспокойство о данных, трудности перехода, опасения передачи системного администрирования.

### 29.2.1. Веб-хостинг третьих сторон

- **Преимущества передачи веб-служб сторонним исполнителям**:
  - Интеграция, использование услуг хостинга, сосредоточение на веб-службах.
  - Сетевая панель управления, надежность и безопасность.
  - Внешний хостинг для эффективного использования труда системных администраторов.
- **Недостатки передачи веб-служб сторонним исполнителям**:
  - Беспокойство о данных, трудности перехода, опасения передачи системного администрирования.
  - Экспорт данных, резервное копирование.

### 29.2.1.3. Унифицированный вход в систему: управление профилями

- **Унифицированный вход**: Единая система паролей для всех приложений.
- **Управление профилями**:
  - Методы управления профилями: .htaccess, .htpasswd, LDAP, Active Directory, PAM, SQL-запросы.
  - Централизованное управление профилями, интеграция с системой аутентификации.

### 29.2.2. Гибридные приложения

- **Гибридные приложения**: Использование данных и API других веб-сайтов.
- **Пример**: HousingMaps.
- **Расширение гибридных приложений**:
  - Компонент объединения.
  - Используемые службы, ограничение и управление API.
- **Отслеживание тенденций**: Мониторинг запросов, определение популярных приложений.
- **Управление гибридными приложениями**:
  - Оценка возможностей и рисков.
  - Блокировка использования веб-служб гибридным приложением.

### 29.3. Заключение

- **Проектирование веб-служб**: Учет основных приложений, горизонтальное и вертикальное расширение.
- **Создание веб-сайта**: Формирование комиссии из заинтересованных лиц, выделенная группа веб-мастеров.
- **Передача служб сторонним исполнителям**: Расширение и эффективное использование ресурсов.
