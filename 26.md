### Глава 26: Резервное копирование и восстановление

#### 26.1 Основы
- **Цель резервного копирования**: Возможность восстановления потерянных данных.
- **Причины потери данных**: Ошибки пользователей, сбои оборудования, катастрофы.
- **Терминология**:
  - **Полное резервное копирование**: Копирование всех файлов раздела.
  - **Инкрементальное резервное копирование**: Копирование измененных файлов с предыдущего резервного копирования.
- **Планирование резервного копирования**:
  - Определение SLA (Service Level Agreement) для восстановления данных.
  - Создание политики и графика резервного копирования.
  - Документирование процедур и графиков.

#### 26.1.1 Причины для восстановления данных
1. **Случайное удаление файлов**: Пользователь случайно удаляет файлы.
2. **Сбой диска**: Полная потеря данных на диске.
3. **Просмотр архивных данных**: Сохранение данных для аварийного восстановления или правовых целей.

#### 26.1.1.1 Случайное удаление файлов
- **Требования**: Быстрое восстановление файлов.
- **Современные системы**: Позволяют пользователям самостоятельно восстанавливать данные.
- **Преимущества**: Снижение нагрузки на системных администраторов, улучшение рабочих процессов пользователей.

#### 26.1.4 SLA и политика восстановления данных
- **Определение SLA**: Письменный документ, указывающий обслуживание и быстродействие.
- **Политика**: Создается в диалоге с пользователями.
- **Пример SLA**:
  - Восстановление файлов с детализацией в один рабочий день за последние полгода.
  - Восстановление после сбоя диска должно занимать 4 часа, с потерей данных не более чем за два рабочих дня.
  - Архивы должны быть полными резервными копиями на отдельных лентах, создаваемыми каждый квартал и хранящимися вечно.

#### 26.1.5 График резервного копирования
- **Установка графика**: Конкретный график резервного копирования.
- **Пример графика**:
  - Полное резервное копирование в пятницу вечером.
  - Инкрементальное резервное копирование с воскресенья по четверг вечером.
- **Периодичность полного резервного копирования**: Ежемесячное создание полных резервных копий.
- **Автоматизация**: Программы резервного копирования могут автоматически создавать график на основе требований.

#### 26.1.5.1 Пример: Пузырьковый динамический график резервного копирования
- **Сортировка разделов**: По дате последнего резервного копирования.
- **Приоритет**: Разделы с наибольшим временем с последнего резервного копирования получают полное резервное копирование.
- **Настройка системы**: Выделение дополнительных устройств записи на ленты для полного или инкрементального резервного копирования.

#### 26.1.5.2 Два уровня инкрементального резервного копирования
- **Преимущества**: Экономия ленты.
- **Недостатки**: Усложнение отслеживания и восстановления данных.
- **Пример**: Полное резервное копирование в начале месяца, инкрементальное копирование уровня 2 в середине месяца.

#### 26.1.6 Планирование времени и емкости
- **Ограничения по времени**: Восстановление и резервное копирование ограничены по времени.
- **Скорость резервного копирования**: Ограничена самым медленным звеном (чтение с диска, запись на резервный носитель, пропускная способность сети).
- **Скорость восстановления**: Определяется факторами, обратными упомянутым.
- **Проблемы с приводами для магнитных лент**: Скорость записи и чтения может сильно различаться.
- **Эффект чистки обуви**: Механизм чтения/записи передвигается вперед-назад над одним и тем же участком ленты.
- **Сетевые проблемы**: Перегрузка сети может замедлить резервное копирование.
- **Восстановление данных**: Поиск одного файла на диске может занять столько же времени, сколько полное восстановление диска.
- **Использование диска как буфера**: Серверы копируют данные на диски узла резервного копирования, затем узел записывает данные на ленту (диск–диск–лента, D2D2T).
- **Тестирование**: Протестировать временные условия резервного копирования и восстановления.

#### 26.1.7 Планирование расходных материалов
- **Политика и график**: Влияют на скорость использования расходных материалов (лент, чистящих лент и т. д.).
- **Пример расчета**:
  - Первые полгода: 1248 лент, 99 840 долларов.
  - Второе полугодие: 260 лент, 18 200 долларов.
  - Второй и третий годы: 36 400 долларов в год.
  - Четвертый и последующие годы: 6000 долларов в год.
- **Изменение политики**: Хранение полных резервных копий только один год снижает средние расходы на 32%.
- **Баланс**: Нахождение равновесия между техническими требованиями и финансовыми ограничениями.

#### 26.1.8 Вопросы процесса восстановления
- **Ожидания пользователей**: Пользователи должны знать политику резервного копирования и как запросить восстановление файла.
- **Безопасность**: Проверка прав доступа и владельцев файлов при восстановлении.
- **Подтверждение запросов**: Запросы на восстановление должны подтверждаться.
- **Документация**: Процесс восстановления должен быть хорошо документирован.
- **Обучение**: Несколько человек должны быть обучены выполнению восстановления.
- **Контактная информация**: В документах должна присутствовать контактная информация служб поддержки и номера контрактов на обслуживание.

#### 26.1.9 Автоматизация резервного копирования
- **Опасность отсутствия автоматизации**: Увеличивает риск человеческой ошибки и ненадежность выполнения резервного копирования.
- **Аспекты автоматизации**: Команды, график, управление лентами и их инвентаризация.
- **Ранняя автоматизация**: Скрипты для воспроизведения команд, алгоритмы создания графиков, автоматизация физической работы с лентами.
- **Преимущества автоматизации**: Снижение объема умственной работы, возможность передачи задачи менее квалифицированным сотрудникам.
- **Пример автоматизации**: Система, которая печатает метки на кассетах и оптимизирует использование лент.
- **Плохая автоматизация**: Не снижает объем умственной работы.
- **Хорошая автоматизация**: Снижает объем умственной работы и выполняет задачи автоматически.

#### 26.1.10 Централизация
- **Централизация резервного копирования**: Снижает расходы на оборудование и трудовые ресурсы.
- **Сетевые системы резервного копирования**: Позволяют подключать крупную технику резервного копирования к одному или нескольким узлам.
- **Приводы с автоматической заменой лент**: Содержат десятки, сотни или тысячи лент и роботизированные манипуляторы.
- **Преимущества централизации**: Снижение расходов на трудовые ресурсы, возможность использования оставшихся блоков в устройстве для завершения задач.

#### 26.1.11 Инвентаризация лент
- **Инвентаризация**: Критически важна для возможности своевременно выполнять восстановление.
- **Инвентаризация в сети**: Ведется крупными автоматизированными системами резервного копирования.
- **Качество инвентаризации**: Влияет на скорость восстановления данных.
- **Пофайловая инвентаризация**: Требует много дискового пространства, но ускоряет процесс восстановления.
- **Восстановление инвентаризации**: Программа должна иметь возможность перестроить инвентаризацию в случае ее потери.
- **Экстренные ситуации**: Возможность восстановления без доступа к инвентаризации и другим системам.

#### 26.2 Тонкости
- **Пробное восстановление**: Периодическое восстановление случайных файлов для проверки качества носителей.
- **Автоматизированные запросы**: Программы для автоматического выбора случайных файлов и запроса их восстановления.
- **Пробное восстановление диска**: Периодическое восстановление всего диска для определения времени и показателей использования.
- **Внешнее хранение**: Хранение лент с резервными копиями в безопасном месте вне основного местоположения компании.
- **Неофициальное внешнее хранение**: Неформальные политики хранения, например, хранение лент дома у сотрудников.
- **Собственное внешнее хранение**: Создание систем внешнего хранения в компаниях с несколькими зданиями.
- **Сетевое внешнее резервное копирование**: Выполнение резервного копирования через сеть между подразделениями.
- **Системы резервного копирования через Интернет**: Услуги резервного копирования через Интернет для домашних и корпоративных пользователей.
- **Базы данных высокой доступности**: Особые требования к резервному копированию баз данных, использование модулей и зеркального отражения.

#### 26.2.1 Пробное восстановление
- **Проверка качества носителей**: Восстановление случайных файлов для проверки качества носителей.
- **Автоматизированные запросы**: Программы для автоматического выбора случайных файлов и запроса их восстановления.
- **Пробное восстановление диска**: Периодическое восстановление всего диска для определения времени и показателей использования.

#### 26.2.2 Резервные носители и внешнее хранение
- **Безопасное хранение**: Хранение лент с резервными копиями в безопасном месте.
- **Внешнее хранение**: Хранение лент вне основного местоположения компании.
- **Неофициальное внешнее хранение**: Неформальные политики хранения, например, хранение лент дома у сотрудников.
- **Собственное внешнее хранение**: Создание систем внешнего хранения в компаниях с несколькими зданиями.
- **Сетевое внешнее резервное копирование**: Выполнение резервного копирования через сеть между подразделениями.
- **Системы резервного копирования через Интернет**: Услуги резервного копирования через Интернет для домашних и корпоративных пользователей.

#### 26.2.3 Базы данных высокой доступности
- **Особые требования**: Базы данных имеют особые требования к резервному копированию.
- **Модули для резервного копирования**: Использование модулей для выполнения резервного копирования определенных баз данных.
- **Зеркальное отражение**: Использование зеркального отражения для безопасного резервного копирования баз данных.

#### 26.2.4 Изменения технологий
- **Постоянные изменения**: Технологии дисков и лент попеременно опережают друг друга.
- **Размер диска**: Удваивается каждые 15–18 месяцев, что требует резервного копирования дисков с большим объемом данных.
- **Емкость лент**: Рост происходит более широкими шагами, но с меньшей частотой.
- **Модернизация оборудования**: Не следует модернизировать слишком часто, чтобы избежать работы с большим количеством различных форматов лент.
- **Старые системы**: Большинство компаний используют главным образом ту технологию, которая была самой совершенной при установке системы.
- **Оставьте один привод для девятидорожечной магнитной ленты**: Пример заслуживания уважения и признательности.

#### 26.3 Заключение
- **Политика резервного копирования**: Основа для всех решений.
- **Типы запросов на восстановление**: Случайное удаление файлов, восстановление после поломки дисков, просмотр архивных данных.
- **График резервного копирования**: Определяется политикой, включает динамические графики.
- **Автоматизация**: Минимизация человеческой работы и ошибок.
- **Централизация**: Экономия сил и распределение стоимости оборудования.
- **Инвентаризация**: Хорошая опись файлов и лент для быстрого восстановления.
- **Экономические подходы**: Снижение риска и затрат на оборудование и расходные материалы.
- **Постоянные изменения технологий**: Необходимость расширения и замены системы каждые 3–5 лет.
- **Пробное восстановление**: Проверка правильности резервного копирования.
- **Внешнее хранение**: Безопасное хранение резервных носителей вне основного местоположения компании.
