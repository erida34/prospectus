### Глава 22: Мониторинг служб

#### 22.1. Основы
- **Типы мониторинга**: Исторический мониторинг и мониторинг в реальном времени.
- **Исторический мониторинг**: Сбор статистических данных долговременной работы, использования и производительности.
- **Мониторинг в реальном времени**: Предупреждение о сбоях и оповещение системных администраторов.
- **Предупреждения**: Пропускная способность сети, ресурсы процессора и памяти, безопасность.

#### 22.1.1. Исторический мониторинг
- **Сбор данных**: Регулярные интервалы для сбора данных об использовании и производительности.
- **Применение данных**: Планирование ресурсов, тарификация, обнаружение аномалий, представление данных руководству.
- **Сокращение данных**: Замена подробных данных средними значениями для экономии места.
- **Сроки хранения**: Установка сроков хранения данных для контроля использования дискового пространства.
- **Уровень детализации**: Определение необходимого уровня детализации и времени хранения данных.
- **Механизмы опроса**: Использование стандартных форм связи и IP-механизмов для сбора данных.
- **Результаты**: Графики с четкими единицами измерения для анализа тенденций и планирования ресурсов.

#### 22.1.2. Мониторинг в реальном времени
- **Функции**: Оповещение о сбоях и проблемах, опрос состояния систем и приложений, получение сообщений от систем.
- **Механизмы оповещения**: Электронная почта, пейджинговая связь, телефон, открытие заявок на устранение неисправности.
- **Хранение данных**: Минимальные требования, хранение предыдущих результатов и времени изменения состояния.
- **Объекты мониторинга**: Доступность и ресурсы, включая процессоры, память, дисковое пространство, сетевые соединения.
- **Гибкость**: Возможность создания собственных тестовых модулей и использования одних и тех же модулей для мониторинга в реальном времени и исторического мониторинга.

#### 22.1.2.1. SNMP
- **Описание**: Simple Network Management Protocol (SNMP) используется для управления сетевыми устройствами.
- **Проблемы**: Простота протокола, безопасность, запрос одной переменной за раз.
- **Рекомендации**:
  1. Конфигурировать сеть для обработки SNMP-пакетов только из определенных диапазонов IP-адресов.
  2. Использовать SNMPv3 с зашифрованными паролями.
  3. Изменять пароли SNMP раз в год с периодом перехода.
  4. Автоматизировать еженедельную проверку всех сетевых устройств.
  5. Следить за бюллетенями безопасности разработчика.

#### 22.1.2.2. Механизм оповещения
- **Функции**: Сообщение о проблемах, координация работы получателей предупреждений.
- **Политика оповещения**: Определение количества получателей, методов координации, частоты и формы оповещений.
- **Ясность сообщений**: Сообщения должны быть понятными и не содержать предположений.
- **Примеры**: «Интерфейс Hssi4/0/0 на маршрутизаторе wan-router-1 не работает», «Веб-сервер на www-20 не отвечает».

#### 22.1.2.3. Передача на более высокий уровень
- **Политика передачи**: Определение времени передачи проблемы на более высокий уровень, обычно руководителю.
- **Пример процедуры передачи**: Сложная процедура с таблицей ответственности, графиками отпусков, иерархией передачи.
- **Подтверждение получения**: Возможность подтверждения получения сообщения для временного прекращения оповещений.

#### 22.1.2.4. Системы активного мониторинга
- **Функции**: Автоматическое устранение проблем, временные меры, открытие заявок на постоянные меры.
- **Ограничения**: Неспособность обнаружить корень проблемы, риск создания новых проблем, ограниченные возможности отладки.
- **Безопасность**: Ограничение доступа автоматизированной системе, уязвимости безопасности.

#### 22.2. Тонкости
- **Расширение мониторинга**: Наблюдение за большим количеством устройств, транзакции целиком, время выполнения транзакций.
- **Доступность**: Документирование системы мониторинга для всей группы, предоставление возможности добавления объектов для наблюдения.
- **Документация**: Информация о SNMP MIB, частоте опроса, уровнях тревоги, приоритетах проблем, графиках, путях передачи.

#### 22.2.2. Тотальный мониторинг
- **Цель**: Наблюдение за всеми системами и службами, особенно важно для компаний с высокой доступностью.
- **Автоматизация**: Включение машин в список для наблюдения как часть процесса установки.
- **Активизация**: Установка средства, активизирующегося при размещении машины в защищенной сети.
- **Автоматическое создание заявок**: Автоматическое создание заявок в службу поддержки для внесения машин в список для наблюдения.

#### 22.2.3. Обнаружение устройств
- **Функции**: Обнаружение новых устройств, подключенных к сети.
- **Преимущества**: Обнаружение устройств, не внесенных в список для наблюдения, знание о добавлении устройств и времени этого события.

#### 22.2.4. Сквозное тестирование
- **Описание**: Тестирование транзакций целиком, имитация пользователя службы.
- **Примеры**: Отправка сообщения электронной почты, запрос веб-страниц, имитация покупки на сайте электронной коммерции.
- **Преимущества**: Обнаружение проблем, которые могут остаться незамеченными при стандартном мониторинге.

#### 22.2.5. Мониторинг времени ответа приложений
- **Цель**: Отслеживание времени ответа приложений для удовлетворения пользователей.
- **Функции**: Создание временных графиков и предупреждений о превышении порогов времени ответа.
- **Преимущества**: Улучшение репутации и производительности, предотвращение потерь бизнеса.

#### 22.2.6. Расширение
- **Проблемы**: Проблемы производительности и расширения при увеличении количества наблюдаемых объектов.
- **Решения**: Использование удаленных зондов для сбора данных, поддержка цепочек взаимосвязей для отображения основных причин проблем.
- **Координация**: Система заявок на устранение неполадок для координации работы системных администраторов над проблемами.

#### 22.2.7. Метамониторинг
- **Цель**: Мониторинг системы мониторинга для обеспечения её работоспособности.
- **Простые показатели**: Наблюдение за заполнением диска, предупреждения о проблемах задолго до критического состояния.
- **Вторая система мониторинга**: Использование второй системы для наблюдения за основной системой мониторинга.
- **SLA**: Основание метамониторинга на SLA, предупреждения при невыполнении запросов в установленное время.
- **Исторический метамониторинг**: Отслеживание производительности системы мониторинга, прогнозирование момента перегрузки.

#### 22.3. Заключение
- **Исторический мониторинг**: Отслеживание доступности и использования систем для анализа и планирования ресурсов.
- **Мониторинг в реальном времени**: Опрос систем для проверки состояния и оповещение о проблемах.
- **Проблемы расширения**: Разделение системы мониторинга на несколько пунктов сбора данных и один центр.
- **Сквозное тестирование**: Имитация пользователя для проверки успешного завершения транзакций.
- **Тестирование времени ответа приложений**: Отслеживание времени ответа приложений для удовлетворения пользователей.
- **Метамониторинг**: Мониторинг системы мониторинга для обеспечения её работоспособности.
