### Гва 25: Хранение данных

#### 25.1 Основы
- **Парадокс хранения данных**:
  - Стоимость отдельного диска снижается.
  - Стоимость управления данными растет.

#### 25.1.1 Терминология
- **25.1.1.1 Основные элементы отдельных дисков**:
  - Шпиндель, пластины, головки.
  - Контроллер диска.
  - Адаптер главной шины (HBA).

- **25.1.1.2 RAID**:
  - **RAID 0**: Распределение данных, быстрее чтение и запись, менее надежен.
  - **RAID 1**: Отражение данных, быстрее чтение, хорошая надежность.
  - **RAID 5**: Распределенный контроль четности, хорошая надежность, медленнее запись.
  - **RAID 10**: Комбинация RAID 0 и RAID 1, высокая надежность и скорость.

- **25.1.1.3 Тома и файловые системы**:
  - Том: элемент хранилища данных, видимый серверу.
  - Файловая система: форматирует том, различные типы для разных целей и проблем производительности.

#### 25.1.1.4 DAS: хранилище прямого подключения
- DAS: жесткий диск, подключенный к серверу.
- Включает RAID-массивы, подключенные напрямую.

#### 25.1.1.5 NAS: хранилище сетевого подключения
- NAS: хранилище, доступное через сеть.
- Примеры: NFS для UNIX, CIFS для Windows.
- Поставщики: Network Appliance, EMC, Linksys.

#### 25.1.1.6 SAN: сети хранения данных
- SAN: сеть с высокой скоростью и низкой задержкой для хранения данных.
- LUN: логический блок, доступный серверу.
- Преимущества: совместное использование ресурсов, снижение изолированного хранения.

#### 25.1.2 Управление хранением
- Управление хранением: комбинация процессов и технологий.
- Важно вовлекать пользователей в управление хранением.

#### 25.1.2.1 Относитесь к системам хранения как к ресурсу сообщества
- Распределение пространства: меньше политики, больше самоуправления.
- Расходы на хранение: 80% накладные расходы.
- Оценка потребностей: важна для планирования и распределения ресурсов.

#### 25.1.2.2 Проведите оценку потребностей хранения
- Оценка потребностей: начать с разговора с пользователями.
- Вопросы: текущее и перспективное использование, планы и проблемы.
- Важно: поддерживать связи и задавать правильные вопросы.

#### 25.1.2.3 Отражайте группы в инфраструктуре хранения
- Группировать пользователей по подразделениям или группам.
- Общие хранилища для специфических требований.
- Квоты: могут быть полезны, но могут вызывать сопротивление.

#### 25.1.2.4 Разработайте политику хранения запасных частей
- Запасные части: важны для инфраструктуры хранения.
- Отделяйте запасные диски общего назначения от запасных дисков для инфраструктуры хранения.
- Прогнозируйте количество необходимых дисков на основе сбоев оборудования в прошлом.
- Планируйте модернизацию серверов и закупку запчастей для новых систем.

#### 25.1.2.5 Планируйте будущее хранение
- Запасные части: часто требуют дополнительных ресурсов.
- Пользователям может понадобиться больше, чем просто диск (например, установка ОС).
- Стандартизация и автоматизация помогают решать проблемы по умолчанию.
- Планируйте ежеквартальные технологические перерывы для обновления системы хранения.

#### 25.1.2.6 Создайте стандарты хранения
- Стандарты помогают отказать в установке нестандартного оборудования.
- Стандарты могут быть простыми или сложными, но должны обеспечивать целостность.
- Преимущества стандартизации: содержание общего набора запчастей, минимизация различных систем.
- Внедрение стандартов может предотвратить проблемы с неподдерживаемыми системами.

#### 25.1.3 Хранение как служба
- Хранение как служба: применяйте стандартные базовые знания о службах.
- SLA хранения: включает доступность, время ответа и MTTR.
- Используйте стандартные средства тестирования для измерения показателей.

#### 25.1.3.1 SLA хранения
- SLA хранения: определяет доступность и время ответа.
- Доступность: достижимость и количество пригодного для использования пространства.
- Время ответа: задержка при заданной загрузке.
- MTTR: среднее время исправления неполадок.

#### 25.1.3.2 Надежность
- Надежность: все рано или поздно ломается.
- RAID и надежность: уровни RAID, кроме RAID 0, увеличивают надежность.
- NAS и надежность: зависит от надежности сети.
- Определите, какую надежность вы можете себе позволить.
- Обеспечение высокой доступности данных стоит дорого.

#### 25.1.3.3 Резервное копирование
- RAID не является стратегией резервного копирования.
- Резервные копии на других носителях (магнитная лента, другой диск) необходимы.
- Зеркальные тома RAID могут использоваться для резервного копирования, но это временно снижает защиту данных.
- NAS и резервное копирование: упрощает резервное копирование, так как все данные хранятся на сервере NAS.
- SAN и резервное копирование: упрощает резервное копирование за счет подключения устройства для записи на магнитную ленту к SAN.

#### 25.1.3.4 Мониторинг
- Мониторинг: важный элемент стратегии соответствия потребностям пользователей.
- Отслеживайте использование пространства, трафик доступа, интенсивность использования процессора.
- Уведомления о заполнении пространства и пиках или провалах в передаче данных.
- Отслеживайте поломок дисков, другие сбои, использование пропускной способности сети, операции с файлами.

#### 25.1.3.5 Предостережения о SAN
- Технологии SAN постоянно меняются, трудно заставить компоненты различных производителей работать вместе.
- Рекомендуется ограничиться одним-двумя производителями и тщательно тестировать решения.
- Новые модели должны проходить тщательное тестирование перед интеграцией в инфраструктуру.
- Создайте набор тестов, важных для вашей среды, включая стандартные тесты, тесты конкретных приложений и специфичные для компании операции.

#### 25.1.4 Быстродействие
- Быстродействие: время, требуемое для чтения и записи данных.
- Оптимизация: сначала измерить, потом оптимизировать на основе данных, затем измерить снова.
- Основные средства оптимизации: оперативная память и шпиндели.

##### Основные правила быстродействия:
1. Никогда не обращайтесь к сети, если вы можете оставаться на диске.
2. Никогда не обращайтесь к диску, если вы можете оставаться в памяти.
3. Никогда не обращайтесь к памяти, если вы можете оставаться на чипе.
4. Имейте достаточно денег и не бойтесь их тратить.

#### 25.1.4.1 RAID и быстродействие
- **RAID 0**: высокое быстродействие чтения и записи, но низкая надежность.
- **RAID 1**: высокое быстродействие чтения, скорость записи определяется самым медленным диском.
- **RAID 3**: хорошее быстродействие при последовательном чтении, рекомендуется для больших графических файлов и видеоприложений.
- **RAID 4 и RAID 5**: высокая скорость чтения, но скорость записи хуже.
- **RAID 10**: высокая скорость чтения и записи, высокая надежность.

#### 25.1.4.2 NAS и быстродействие
- NAS: изолирует нагрузку по передаче файлов от остальных серверов.
- Упрощает применение политик резервного копирования, использования и безопасности.
- Перемещение файлов в NAS снижает загрузку сервера, повышая быстродействие.

#### 25.1.4.3 SAN и быстродействие
- SAN: убирает трафик файлов из основной сети, обеспечивает низкую задержку и высокую скорость.
- Изолируется от других сетей, предоставляя преимущество в безопасности.
- Fibre channel и iSCSI позволяют инкапсулировать SCSI-команды и отправлять их по сети.

#### 25.1.4.4 Оптимизация конвейерной обработки данных
- Конвейерная обработка данных: предварительная загрузка данных для минимизации времени доступа.
- Алгоритмы конвейерной обработки: "глупые" и "умные".
- Запись данных: операционные системы обеспечивают атомарную запись, подтверждение записи немедленно рискованно.

#### 25.1.5 Оценка новых решений по хранению
- Оценка новых решений: зависит от модели использования.
- Пропускная способность и конфигурация подсистем или компонентов.
- Скрытые "подводные камни": использование ресурсов памяти и процессора сервера.
- Тестирование всех элементов новой системы.

#### 25.1.6 Распространенные проблемы
- Распространенные проблемы: граничные условия, цепная реакция сбоев.
- Физическая инфраструктура: требования по электропитанию и охлаждению.
- Проверка стабильности инфраструктуры питания.
- Индикатор потребляемой мощности для оценки требований систем хранения.

#### 25.1.6.2 Превышение времени ожидания
- Превышение времени ожидания: проблема в сильно оптимизированных системах.
- NAS и SAN: чувствительны к изменениям в конфигурации сетей.
- Превышение времени ожидания может возникнуть на стороне клиента.
- При сильной нагрузке задержка может вызвать превышение времени ожидания TCP.

#### 25.1.6.3 Поведение при перегрузке
- Перегрузка: может вызвать задержки и медленные ответы.
- Плотность доступа к диску (DAD): важна при выборе систем хранения.
- Высокая интенсивность ввода/вывода требует лучшего соотношения DAD.
- Планирование инфраструктуры хранения: выделение серверов хранения для конкретных приложений.

#### 25.2 Тонкости
- Оптимизация использования RAID по приложениям.
- Настройка распределения данных: выравнивание размера блока с размером блока данных приложений.
- Упорядочение записи: перемещение интенсивно записываемых участков на другой диск.

#### 25.2.1 Оптимизация использования RAID
- Настройка распределения данных: важна для баз данных и серверов приложений.
- Размер блока должен поддерживаться всем путем ввода/вывода.
- Упорядочение записи: перемещение интенсивно записываемых участков на другой диск.

#### 25.2.1.1 Настройка распределения данных
- Изменение размера блока базы данных до размера блока распределения данных.
- Пример: размер блока распределения в 8 Кб для массива из пяти дисков RAID 5.
- Настройка: не разделять системы хранения между различающимися приложениями.

#### 25.2.1.2 Упорядочение записи
- Проблемы быстродействия: вызваны несколькими операциями записи в независимые потоки данных.
- Перемещение файла лога на другой диск повышает быстродействие.
- Примеры: базы данных, процессы сборки программ, файловые системы с протоколированием.

#### 25.2.2 Пределы хранения: отставание плотности доступа к диску
- Плотность доступа к диску (DAD): измеряется в операциях ввода/вывода в секунду на гигабайт емкости.
- Высокая интенсивность ввода/вывода требует лучшего соотношения DAD.
- Планирование инфраструктуры хранения: выделение серверов хранения для конкретных приложений.
- Примеры: базы данных, файловые системы инженерных подразделений.

#### 25.2.2.1 Фрагментация
- Фрагментация: перемещение головки диска на новое место происходит медленно.
- Современные операционные системы: лучше удается не создавать фрагментированные файлы.
- Дефрагментация диска: риск уничтожения данных.
- Многопользовательские системы: фрагментация влияет меньше на быстродействие.

#### 25.2.3 Непрерывная защита данных
- Непрерывная защита данных (CDP): процесс копирования изменений данных в определенный временной промежуток.
- CDP: позволяет восстановить данные до желаемого момента.
- CDP: используется для минимизации времени восстановления и снижения вероятности потери данных.
- CDP: дорогая технология, используется для критически важных данных.
- Причины использования CDP: соблюдение норм отрасли, предотвращение потери прибыли.

#### 25.3 Заключение
- Основные принципы управления хранением: реализация решения по хранению в соответствии с нуждами приложений или пользователей.
- Отношение к хранению как к службе: позволяет установить точку отсчета при определении расходов.
- Возможности предоставления услуг по хранению данных: выбор уровня надежности и быстродействия.
- Понимание основных принципов связи устройств хранения с операционной системой и файловой системой.
- Использование концепций, таких как RAID, для построения решений по хранению.
- Проблема неравномерности роста плотности диска и пропускной способности ввода/вывода диска.
