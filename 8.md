# Глава 8: Пространства имен

## Основные понятия
- **Пространство имен** — набор уникальных ключей и их атрибутов.
  - Примеры: регистрационные записи, имена хостов, Ethernet-адреса, списки сервисов/портов.
  - Атрибуты: UID/SID, IP-адреса, MAC-адреса, информация о владельце и т.д.

- **Типы пространств имен**:
  - **Плоские**: уникальные ключи без дубликатов (например, UID в UNIX, WINS в Windows).
  - **Иерархические**: структурированные, с возможностью дублирования имен на разных уровнях (например, дерево каталогов).

## Управление пространствами имен
- **Формализация управления**:
  - В небольших системах управление может быть неформальным.
  - В крупных системах требуется четкая организация и делегирование ответственности.

- **Ключевые аспекты**:
  - **Политики**: правила именования, долговечность, локализация, защита.
  - **Процедуры**: добавление, изменение, удаление элементов.
  - **Централизованное управление**: необходимо для согласованности и контроля.

## Важность пространств имен
- Без пространств имен данные становятся беспорядочными.
- Важно рассматривать пространства имен в контексте всей системы, а не изолированно.
- Навык видеть "лес за деревьями" помогает эффективно управлять системами.

## Основы управления пространствами имен
- **Политики**: должны быть четко определены для имен, долговечности, локализации и защиты.
- **Процедуры**: должны включать добавление, изменение и удаление элементов.
- **Централизация**: необходима для эффективного управления и контроля.

# 8.1.1. Политики для пространств имен

## Основные принципы
- Политики должны быть **письменными**, особенно в крупных организациях.
- Письменные политики:
  - Основа для автоматизации управления пространствами имен.
  - Регулируют отношения с клиентами и обучение новых сотрудников.

## 8.1.1.1. Назначение имен
- Политика должна отвечать на вопросы:
  - Какие имена разрешены/запрещены?
  - Как выбираются имена?
  - Как решаются конфликты имен?
  - Когда допускается переименование?

### Методы назначения имен:
1. **Шаблонный**: строгий шаблон (например, `pc-1234`).
2. **Тематический**: имена по теме (например, планеты).
3. **Функциональный**: имена по функциям (например, `dns1`, `web01`).
4. **Описательный**: имена отражают факты (например, `S:\Otdel\Finance`).
5. **Без метода**: имена выбираются произвольно, конфликты решаются по мере поступления.

### Слияние пространств имен
- При слиянии компаний возникают конфликты имен.
- Решения:
  - **Серверы**: добавление псевдонима компании (например, `gandalf-CompanyaA`).
  - **Логины**: приоритет у сотрудника с большим стажем.
  - **Электронная почта**: переадресация с изменением адресов.

### Функциональные имена
- Упрощают конфигурацию ПО (например, `pochta`, `calendar`).
- Псевдонимы (например, DNS CNAME) полезны для неинтерактивных серверов.

### Последовательные имена
- Шаблонные имена могут создавать ложное впечатление завершенности.
- Тематические имена могут быть неудобными (например, принтеры с именами кофе).

### Имена и безопасность
- Имена могут привлекать внимание мошенников (например, `sourcecodedb`).
- Рекомендуется избегать выделяющихся имен для машин администраторов.

### Сложные имена
- Сложные имена могут использоваться для ограничения доступа (например, `ramanujan` vs `boole`).

### Рекомендации
- Имена узлов должны быть простыми и информативными.
- Для настольных рабочих станций удобно использовать имена пользователей (например, `ajaypc`).

# 8.1.1.2. Контроль доступа

## Основные вопросы политики контроля доступа:
- Какая защита и уровень безопасности требуются?
- От чего и зачем защищать имена?
- Нужно ли защищать только имена или их атрибуты?
- Кто может добавлять, изменять или удалять записи?
- Может ли владелец записи изменять определенные поля?

### Уровни доступа:
- **Просмотр**: доступ к пространству имен может быть ограничен (например, список паролей).
- **Изменения**: только определенные пользователи могут вносить изменения.
- **Создание/удаление**: ограничено администраторами или специальными системами.

### Примеры:
- В UNIX:
  - Файл `/etc/passwd` содержит UID, имена, домашние директории.
  - Файл `/etc/shadow` с паролями должен быть лучше защищен.
- В корпоративных системах:
  - Логины могут быть публичными, но полный список не должен быть доступен всем.

### Защита изменений:
- Использование систем контроля версий (например, SubVersion, SourceSafe).
- Резервное копирование — обязательная часть защиты пространств имен.

### Методы защиты:
- Шифрование доступа и обновлений.
- Аутентификация через защищенные механизмы (не только пароли).

# 8.1.1.3. Долговечность пространства имен

## Основные вопросы:
- Когда удалять записи в пространстве имен?
- Как долго имена остаются актуальными?

### Политики долговечности:
- Учетные записи могут удаляться после периода бездействия.
- IP-адреса могут освобождаться, если не используются длительное время.

### Проблемы долговечности:
- Имена, закрепленные в памяти пользователей, сложно изменить (например, адреса электронной почты на визитках).
- Перемещение ресурсов (например, файловых серверов) может вызывать проблемы, если имена жестко привязаны.

### Решения:
- Использование псевдонимов для скрытия реальных имен серверов.
- Пример: веб-сервер не должен называться `www`, а `www` должен быть псевдонимом.
- Технологии, такие как NFS, могут требовать перезагрузки клиентов для применения изменений.

### Пример:
- Сервер с именем `calendar` использовался для печати, что вызывало путаницу. Решение: использовать псевдонимы для функциональных имен (например, `printer`).

# 8.1.1.4. Вопросы сферы действия

## Основные вопросы:
- Где будет применяться пространство имен?
- **Диаметр**: географическая широта использования (один узел, кластер, отдел, организация).
- **Плотность**: количество сервисов, использующих пространство имен.

### Диаметр пространства имен:
- Примеры:
  - **Локальное**: база данных имен пользователей для одного подразделения.
  - **Глобальное**: RADIUS для аутентификации в модемных пулах по всему миру.
  - **Кластерное**: NIS для UNIX-кластеров.

### Плотность пространства имен:
- Пример: уникальный идентификатор сотрудника (например, `tal`) используется для:
  - Электронной почты.
  - Логинов.
  - VPN и модемных пулов.
- Даже если системы используют разные базы данных, идентификатор остается единым.

### Проблемы с диаметром:
- Коллизии имен в разных отделах (например, `tal` может быть разными людьми).
- Решения:
  - Глобальное пространство имен (например, метки в Lucent).
  - Иерархические пространства имен (например, DNS с зонами и подзонами).

### Пример: Lucent
- Каждый сотрудник получает уникальную "метку" (например, `tal`).
- Метка используется во всех внутренних сервисах (электронная почта, кадры, удаленный доступ).
- Преимущества:
  - Упрощение управления учетными записями.
  - Минимизация коллизий при слияниях компаний.

### Пример: электронная коммерция
- Широкие и плотные пространства имен:
  - Одно имя и пароль для всех сервисов (например, Yahoo).
  - Удобство для пользователей, но требует высокой координации на стороне сервиса.

# 8.1.1.5. Целостность

## Основные вопросы:
- Какие атрибуты должны сохраняться при использовании одного имени в нескольких пространствах имен?
- **Высокая целостность**: имя имеет одинаковые атрибуты во всех системах.

### Пример: Bell Labs Research
- **Соглашение о UID**: системные администраторы разделили диапазоны UID между исследовательскими центрами.
- **Результат**: минимизация конфликтов UID при слиянии систем.
- **Причина успеха**: простое и разумное решение, принятое на основе соглашения.

### Пример: DNS-сервер в Bell Labs
- **Проблема**: UID на DNS-сервере отличались от UID в других системах.
- **Решение**: UID новых учетных записей должны соответствовать UID домашних систем.
- **Цель**: предотвращение проблем при восстановлении данных на других узлах.

# 8.1.1.6. Повторное использование

## Основные вопросы:
- Через какое время после удаления имя может использоваться повторно?
- **Обычно**: имена можно повторно использовать сразу (например, имена принтеров).
- **Исключения**:
  - Адреса электронной почты: задержка в 6 месяцев для предотвращения путаницы.
  - Пример: предотвращение злонамеренного перенаправления почты.

### Политика повторного использования:
- **Программная реализация**: автоматизация задержки повторного использования.
- **Ручное управление**: в небольших системах системный администратор должен учитывать последствия повторного использования.

# 8.1.1.7. Выводы

## Основные принципы:
- Политики должны быть **документированы** и одобрены управляющим и техническим персоналом.
- **Политики включают**:
  - Назначение имен.
  - Контроль доступа.
  - Долговечность.
  - Сферу действия.
  - Целостность.
  - Повторное использование.

### Преимущества документации:
- Предотвращение разногласий между системными администраторами.
- Упрощение обучения новых сотрудников.
- Обеспечение масштабируемости системы.

### Неформальный подход:
- Работает в небольших системах, но становится проблемой при расширении.
- Документация помогает избежать хаоса при увеличении числа администраторов.

# 8.1.2. Процедуры изменения пространства имен

## Основные процедуры:
- **Добавление**, **изменение** и **удаление** элементов пространства имен.
- **Документация**:
  - Необходима для обучения новых системных администраторов.
  - Может быть основой для автоматизации процессов.

## Автоматизация:
- Если процедуры можно задокументировать, их можно автоматизировать.
- Автоматизация не обязательно должна быть сложной.

# 8.1.3. Централизация управления пространством имен

## Основные принципы:
- Управление должно быть **централизованным** для обеспечения целостности.
- **Преимущества централизации**:
  - Упрощение управления.
  - Упрощение распространения изменений.
  - Повышение согласованности данных.

### Пример: очистка пространства имен
- **Проблема**:
  - Пространства имен были разрозненными, с разными скриптами и директориями.
  - Отсутствие системы контроля версий (RCS/SCCS).
  - Зависимость от резервных копий для отмены изменений.
- **Решение**:
  - Все контрольные файлы перемещены в единую директорию.
  - Внедрена система управления версиями (RCS).
  - Создан единый `Makefile` для управления изменениями.
- **Результат**:
  - Упрощение администрирования.
  - Упрощение обучения новых администраторов.
  - Возможность оптимизации и автоматизации процессов.

### Автоматизация и инструменты:
- **GNU cfengine**: инструмент для управления конфигурациями и распространения файлов в UNIX.
- **Microsoft ActiveDirectory** и **OpenDirectory (Mac OS X)**: централизованное хранение информации о пространствах имен через LDAP-серверы.

## Итог:
- Централизация и автоматизация упрощают управление пространствами имен.
- Документация и контроль версий — ключевые элементы для поддержания целостности системы.


# 8.2. Тонкости

## 8.2.1. Одна большая база данных
- **Централизация**: объединение всех пространств имен в одну базу данных SQL.
- **Преимущества**:
  - Упрощение управления.
  - Возможность создания клиентских приложений (веб- или GUI) для операторов.
  - Интеграция с другими системами (ActiveDirectory, LDAP, NIS и т.д.).
- **Инструменты**: Postgres, MySQL (снижение затрат благодаря открытому исходному коду).

## 8.2.2. Дальнейшая автоматизация
- **Основы автоматизации**:
  - Первичная автоматизация упрощает внедрение более сложных процессов.
  - Пример: проверка безопасности файлов (например, `.rhosts`) через итерацию по пространству имен `passwd`.
- **Автоматизация на основе данных**:
  - Генерация списков рассылки из корпоративной директории.
  - Поддержка актуальности учетной базы данных.

### Пример: автоматизированная учетная база данных
- **Функционал**:
  - Запросы к базе данных из скриптов.
  - Выполнение команд на списке узлов.
- **Преимущества**:
  - Глобальное внесение изменений.
  - Определение узлов с определенными характеристиками (ОС, версия, память и т.д.).

## 8.2.3. Обновление, управляемое пользователем
- **Самостоятельность пользователей**:
  - Автоматизация рутинных задач (например, выдача IP-адресов через DHCP).
  - Анализ журналов запросов для выявления задач, которые можно автоматизировать.

### Пример: создание учетных записей в университете Ратджерса
- **Автоматизация**:
  - Массовое создание и удаление учетных записей для студентов.
  - Использование базы данных по зачислению.
- **Преимущества**:
  - Снижение нагрузки на системных администраторов.
  - Упрощение управления учебными процессами.

## 8.2.4. Эффективное использование пространств имен
- **Интеграция с некомпьютерной инфраструктурой**:
  - Офисные АТС, голосовая почта, системы доступа по смарт-картам.
  - Использование LDAP для централизованного управления.
- **Пример**:
  - Создание учетных записей для новых сотрудников с автоматической настройкой:
    - Электронная почта.
    - Телефон и голосовая почта.
    - Доступ по смарт-карте.

# 8.3. Заключение

## Основные принципы:
- **Правила для пространств имен**:
  - Назначение имен.
  - Контроль доступа.
  - Долговечность.
  - Сфера действия.
  - Целостность.
  - Повторное использование.
- **Процедуры**: должны основываться на правилах.

## Преимущества:
- **Централизация и автоматизация**:
  - Улучшение согласованности.
  - Упрощение управления.
  - Возможность дальнейшей автоматизации.
- **Интеграция**:
  - Привязка некомпьютерной инфраструктуры к централизованным базам данных.

## Итог:
- Эффективное управление пространствами имен — ключ к стабильной работе систем.
- Автоматизация и централизация позволяют достичь максимальной эффективности.